/* 
 * iPhone Edge-to-Edge Layout Fix
 * Created: 2025-01-06
 * Purpose: Enable true edge-to-edge width on iPhone Safari and Chrome
 * 
 * TO REVERT: 
 * 1. Remove viewport-fit=cover from index.html viewport meta tag
 * 2. Delete this file or comment out the import in App.complete.jsx
 * 3. The app will return to the previous contained width behavior
 */

/* === SAFE AREA INSETS FOR EDGE-TO-EDGE LAYOUT === */

/* Apply safe area padding to the root app container */
#root {
  /* Use the full viewport width */
  width: 100vw;
  min-height: 100vh;
  
  /* Safe area padding for notched devices (iPhone X and later) */
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  
  /* Fallback for older devices without notches */
  padding-left: constant(safe-area-inset-left);
  padding-right: constant(safe-area-inset-right);
  padding-top: constant(safe-area-inset-top);
  padding-bottom: constant(safe-area-inset-bottom);
}

/* Main app container adjustments */
.app {
  /* Remove any fixed padding that might prevent edge-to-edge */
  padding-left: 0;
  padding-right: 0;
  width: 100%;
  max-width: none; /* Remove any max-width constraints on mobile */
}

/* Header adjustments for edge-to-edge */
.header {
  /* Extend header to edges while respecting safe areas */
  margin-left: calc(-1 * env(safe-area-inset-left));
  margin-right: calc(-1 * env(safe-area-inset-right));
  padding-left: calc(12px + env(safe-area-inset-left));
  padding-right: calc(12px + env(safe-area-inset-right));
  
  /* Fallback for older devices */
  margin-left: calc(-1 * constant(safe-area-inset-left));
  margin-right: calc(-1 * constant(safe-area-inset-right));
  padding-left: calc(12px + constant(safe-area-inset-left));
  padding-right: calc(12px + constant(safe-area-inset-right));
}

/* Content area adjustments */
.content {
  /* Add horizontal padding that respects safe areas */
  padding-left: max(15px, env(safe-area-inset-left));
  padding-right: max(15px, env(safe-area-inset-right));
  
  /* Fallback */
  padding-left: max(15px, constant(safe-area-inset-left));
  padding-right: max(15px, constant(safe-area-inset-right));
}

/* Story display adjustments */
.story-display-wrapper,
.story-card {
  /* Use full width minus safe areas */
  width: 100%;
  max-width: none;
  margin-left: 0;
  margin-right: 0;
}

/* Form controls should respect safe areas */
.form-control,
.form-select,
input[type="text"],
input[type="email"],
select,
textarea {
  /* Ensure form elements don't extend into unsafe areas */
  max-width: 100%;
}

/* Buttons that might be near edges */
.floating-button,
.fixed-button {
  /* Position floating buttons within safe areas */
  left: max(20px, env(safe-area-inset-left));
  right: max(20px, env(safe-area-inset-right));
  bottom: max(20px, env(safe-area-inset-bottom));
}

/* === IPHONE-SPECIFIC MEDIA QUERIES === */

/* iPhone SE to iPhone 8 Plus */
@media screen and (max-width: 414px) {
  .app {
    padding: 0;
  }
  
  .content {
    padding-left: max(10px, env(safe-area-inset-left));
    padding-right: max(10px, env(safe-area-inset-right));
  }
}

/* iPhone X and later (with notch) */
@media screen and (max-width: 428px) and (min-height: 812px) {
  /* Extra top padding for notch */
  .header {
    padding-top: calc(12px + env(safe-area-inset-top));
  }
  
  /* Bottom padding for home indicator */
  .content {
    padding-bottom: calc(20px + env(safe-area-inset-bottom));
  }
}

/* Landscape orientation on iPhone */
@media screen and (max-width: 896px) and (max-height: 428px) and (orientation: landscape) {
  #root {
    /* Landscape needs extra care for safe areas */
    padding-left: max(44px, env(safe-area-inset-left));
    padding-right: max(44px, env(safe-area-inset-right));
  }
  
  .header {
    /* Adjust header for landscape notches */
    margin-left: calc(-1 * max(44px, env(safe-area-inset-left)));
    margin-right: calc(-1 * max(44px, env(safe-area-inset-right)));
    padding-left: max(44px, env(safe-area-inset-left));
    padding-right: max(44px, env(safe-area-inset-right));
  }
}

/* === OVERRIDE CONTAINER MAX-WIDTH ON MOBILE === */

@media screen and (max-width: 768px) {
  /* Remove max-width constraints for edge-to-edge on mobile */
  .container,
  .main-container,
  .app-container,
  .content-wrapper {
    max-width: none !important;
    width: 100% !important;
  }
  
  /* Story library should be full width */
  .library-grid {
    padding-left: max(10px, env(safe-area-inset-left));
    padding-right: max(10px, env(safe-area-inset-right));
  }
  
  /* Modal adjustments for edge-to-edge */
  .modal,
  .popup {
    left: env(safe-area-inset-left);
    right: env(safe-area-inset-right);
    width: calc(100% - env(safe-area-inset-left) - env(safe-area-inset-right));
  }
}

/* === SPECIFIC ADJUSTMENTS FOR KNOWN ELEMENTS === */

/* Achievement system modal */
.achievement-popup {
  left: env(safe-area-inset-left);
  right: env(safe-area-inset-right);
  max-width: calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right));
}

/* Profile manager */
.profile-manager {
  padding-left: max(15px, env(safe-area-inset-left));
  padding-right: max(15px, env(safe-area-inset-right));
}

/* Story generation form */
.story-form {
  padding-left: max(15px, env(safe-area-inset-left));
  padding-right: max(15px, env(safe-area-inset-right));
}

/* === TESTING HELPERS (REMOVE IN PRODUCTION) === */

/* Visual indicator of safe areas (for testing only) */
.debug-safe-areas::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: env(safe-area-inset-top);
  background: rgba(255, 0, 0, 0.1);
  pointer-events: none;
  z-index: 9999;
}

.debug-safe-areas::after {
  content: '';
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: env(safe-area-inset-bottom);
  background: rgba(0, 0, 255, 0.1);
  pointer-events: none;
  z-index: 9999;
}

/* === COMPATIBILITY AND FALLBACKS === */

/* Ensure compatibility with older Safari versions */
@supports not (padding: env(safe-area-inset-left)) {
  /* Fallback for browsers that don't support env() */
  #root {
    padding: 0;
  }
  
  .header {
    margin: 0;
    padding: 12px;
  }
  
  .content {
    padding: 15px;
  }
}

/* === FINAL OVERRIDES === */

/* Ensure nothing has horizontal margins that could break edge-to-edge */
@media screen and (max-width: 768px) {
  body > * {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  /* But maintain safe area padding */
  body {
    padding-left: env(safe-area-inset-left) !important;
    padding-right: env(safe-area-inset-right) !important;
  }
}